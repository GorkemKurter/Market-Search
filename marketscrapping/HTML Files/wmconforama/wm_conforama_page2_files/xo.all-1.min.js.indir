var xo=function(e){"use strict";var t;!function(e){e.Post="POST",e.Get="GET",e.Put="PUT",e.Patch="PATCH",e.Delete="DELETE"}(t||(t={}));var r,a=window&&window.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),s=function(e){function t(r){var a=e.call(this,r)||this;return a.name="TimeoutError",Object.setPrototypeOf(a,t.prototype),a}return a(t,e),t}(Error),i=window&&window.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(s,i){function o(e){try{p(a.next(e))}catch(e){i(e)}}function n(e){try{p(a.throw(e))}catch(e){i(e)}}function p(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,n)}p((a=a.apply(e,t||[])).next())}))},o=window&&window.__generator||function(e,t){var r,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function n(n){return function(p){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,n[0]&&(o=0)),o;)try{if(r=1,a&&(s=2&n[0]?a.return:n[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,a=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],a=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,p])}}},n=function(){function e(e){this.scope=e}return e.prototype.send=function(e){return i(this,void 0,void 0,(function(){var t,r,a;return o(this,(function(i){switch(i.label){case 0:return(t={method:e.method,headers:e.headers||{},body:e.body,keepalive:e.keepalive,referrerPolicy:e.referrerPolicy||"no-referrer",cache:e.cache}).headers["X-SDK"]="1",[4,Promise.race([this.scope.fetch(e.url,t),Number.isInteger(e.timeout)&&new Promise((function(t,r){setTimeout((function(){return r(new s)}),e.timeout)}))].filter((function(e){return e instanceof Promise})))];case 1:return r=i.sent(),a={status:r.status},[4,r.text()];case 2:return[2,(a.body=i.sent(),a)]}}))}))},e}();let p;const c=new Uint8Array(16);function u(){if(!p&&(p="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!p))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return p(c)}const d=[];for(let e=0;e<256;++e)d.push((e+256).toString(16).slice(1));var h={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function y(e,t,r){if(h.randomUUID&&!t&&!e)return h.randomUUID();const a=(e=e||{}).random||(e.rng||u)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]}(a)}function m(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var l={exports:{}};l.exports=v,l.exports.default=v;var f={$schema:"http://json-schema.org/draft-07/schema#",definitions:{User:{properties:{identities:{additionalProperties:{type:"string"},type:"object"},segments:{items:{type:"string"},type:"array"},traits:{additionalProperties:{},type:"object"}},required:["identities"],type:"object"}},properties:{action:{type:"string"},metadata:{additionalProperties:{anyOf:[{items:{},type:"array"},{type:["string","number","boolean"]}]},properties:{currency:{type:"string"},market:{type:"string"},orderId:{type:"string"},price:{type:"number"},quantity:{type:"number"}},type:"object"},opposite:{type:"boolean"},segments:{items:{type:"string"},type:"array"},sourceId:{type:"string"},target:{additionalProperties:{type:"string"},type:"object"},timestamp:{type:"string"},user:{$ref:"#/definitions/User"}},required:["action","target"],type:"object"},g={properties:{identities:{additionalProperties:{type:"string"},type:"object"},segments:{items:{type:"string"},type:"array"},traits:{additionalProperties:{},type:"object"}},required:["identities"],type:"object"};function v(e,t){if(t){var r=t.instancePath;t.parentData,t.parentDataProperty,t.rootData}else r="";var a=null,s=0;if(e&&"object"==typeof e&&!Array.isArray(e)){if(void 0===e.action){var i={instancePath:r,schemaPath:"#/required",keyword:"required",params:{missingProperty:"action"},message:"must have required property 'action'",schema:f.required,parentSchema:f,data:e};null===a?a=[i]:a.push(i),s++}if(void 0===e.target){var o={instancePath:r,schemaPath:"#/required",keyword:"required",params:{missingProperty:"target"},message:"must have required property 'target'",schema:f.required,parentSchema:f,data:e};null===a?a=[o]:a.push(o),s++}if(void 0!==e.action){var n=e.action;if("string"!=typeof n){var p={instancePath:r+"/action",schemaPath:"#/properties/action/type",keyword:"type",params:{type:"string"},message:"must be string",schema:f.properties.action.type,parentSchema:f.properties.action,data:n};null===a?a=[p]:a.push(p),s++}}if(void 0!==e.metadata){var c=e.metadata;if(c&&"object"==typeof c&&!Array.isArray(c)){for(var u in c)if("currency"!==u&&"market"!==u&&"orderId"!==u&&"price"!==u&&"quantity"!==u){var d=c[u],h=s,y=!1,m=s;if(!Array.isArray(d)){var l={instancePath:r+"/metadata/"+u.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/metadata/additionalProperties/anyOf/0/type",keyword:"type",params:{type:"array"},message:"must be array",schema:f.properties.metadata.additionalProperties.anyOf[0].type,parentSchema:f.properties.metadata.additionalProperties.anyOf[0],data:d};null===a?a=[l]:a.push(l),s++}var b=m===s;if(!(y=y||b)){var P=s;if("string"!=typeof d&&("number"!=typeof d||!isFinite(d))&&"boolean"!=typeof d){var w={instancePath:r+"/metadata/"+u.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/metadata/additionalProperties/anyOf/1/type",keyword:"type",params:{type:f.properties.metadata.additionalProperties.anyOf[1].type},message:"must be string,number,boolean",schema:f.properties.metadata.additionalProperties.anyOf[1].type,parentSchema:f.properties.metadata.additionalProperties.anyOf[1],data:d};null===a?a=[w]:a.push(w),s++}b=P===s;y=y||b}if(y)s=h,null!==a&&(h?a.length=h:a=null);else{var S={instancePath:r+"/metadata/"+u.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/metadata/additionalProperties/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf",schema:f.properties.metadata.additionalProperties.anyOf,parentSchema:f.properties.metadata.additionalProperties,data:d};null===a?a=[S]:a.push(S),s++}}if(void 0!==c.currency){var A=c.currency;if("string"!=typeof A){var k={instancePath:r+"/metadata/currency",schemaPath:"#/properties/metadata/properties/currency/type",keyword:"type",params:{type:"string"},message:"must be string",schema:f.properties.metadata.properties.currency.type,parentSchema:f.properties.metadata.properties.currency,data:A};null===a?a=[k]:a.push(k),s++}}if(void 0!==c.market){var O=c.market;if("string"!=typeof O){var q={instancePath:r+"/metadata/market",schemaPath:"#/properties/metadata/properties/market/type",keyword:"type",params:{type:"string"},message:"must be string",schema:f.properties.metadata.properties.market.type,parentSchema:f.properties.metadata.properties.market,data:O};null===a?a=[q]:a.push(q),s++}}if(void 0!==c.orderId){var j=c.orderId;if("string"!=typeof j){var C={instancePath:r+"/metadata/orderId",schemaPath:"#/properties/metadata/properties/orderId/type",keyword:"type",params:{type:"string"},message:"must be string",schema:f.properties.metadata.properties.orderId.type,parentSchema:f.properties.metadata.properties.orderId,data:j};null===a?a=[C]:a.push(C),s++}}if(void 0!==c.price){var I=c.price;if("number"!=typeof I||!isFinite(I)){var x={instancePath:r+"/metadata/price",schemaPath:"#/properties/metadata/properties/price/type",keyword:"type",params:{type:"number"},message:"must be number",schema:f.properties.metadata.properties.price.type,parentSchema:f.properties.metadata.properties.price,data:I};null===a?a=[x]:a.push(x),s++}}if(void 0!==c.quantity){var T=c.quantity;if("number"!=typeof T||!isFinite(T)){var _={instancePath:r+"/metadata/quantity",schemaPath:"#/properties/metadata/properties/quantity/type",keyword:"type",params:{type:"number"},message:"must be number",schema:f.properties.metadata.properties.quantity.type,parentSchema:f.properties.metadata.properties.quantity,data:T};null===a?a=[_]:a.push(_),s++}}}else{var B={instancePath:r+"/metadata",schemaPath:"#/properties/metadata/type",keyword:"type",params:{type:"object"},message:"must be object",schema:f.properties.metadata.type,parentSchema:f.properties.metadata,data:c};null===a?a=[B]:a.push(B),s++}}if(void 0!==e.opposite){var U=e.opposite;if("boolean"!=typeof U){var E={instancePath:r+"/opposite",schemaPath:"#/properties/opposite/type",keyword:"type",params:{type:"boolean"},message:"must be boolean",schema:f.properties.opposite.type,parentSchema:f.properties.opposite,data:U};null===a?a=[E]:a.push(E),s++}}if(void 0!==e.segments){var R=e.segments;if(Array.isArray(R))for(var D=R.length,z=0;z<D;z++){var F=R[z];if("string"!=typeof F){var M={instancePath:r+"/segments/"+z,schemaPath:"#/properties/segments/items/type",keyword:"type",params:{type:"string"},message:"must be string",schema:f.properties.segments.items.type,parentSchema:f.properties.segments.items,data:F};null===a?a=[M]:a.push(M),s++}}else{var N={instancePath:r+"/segments",schemaPath:"#/properties/segments/type",keyword:"type",params:{type:"array"},message:"must be array",schema:f.properties.segments.type,parentSchema:f.properties.segments,data:R};null===a?a=[N]:a.push(N),s++}}if(void 0!==e.sourceId){var G=e.sourceId;if("string"!=typeof G){var $={instancePath:r+"/sourceId",schemaPath:"#/properties/sourceId/type",keyword:"type",params:{type:"string"},message:"must be string",schema:f.properties.sourceId.type,parentSchema:f.properties.sourceId,data:G};null===a?a=[$]:a.push($),s++}}if(void 0!==e.target){var L=e.target;if(L&&"object"==typeof L&&!Array.isArray(L))for(var V in L){var J=L[V];if("string"!=typeof J){var H={instancePath:r+"/target/"+V.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/target/additionalProperties/type",keyword:"type",params:{type:"string"},message:"must be string",schema:f.properties.target.additionalProperties.type,parentSchema:f.properties.target.additionalProperties,data:J};null===a?a=[H]:a.push(H),s++}}else{var K={instancePath:r+"/target",schemaPath:"#/properties/target/type",keyword:"type",params:{type:"object"},message:"must be object",schema:f.properties.target.type,parentSchema:f.properties.target,data:L};null===a?a=[K]:a.push(K),s++}}if(void 0!==e.timestamp){var X=e.timestamp;if("string"!=typeof X){var Q={instancePath:r+"/timestamp",schemaPath:"#/properties/timestamp/type",keyword:"type",params:{type:"string"},message:"must be string",schema:f.properties.timestamp.type,parentSchema:f.properties.timestamp,data:X};null===a?a=[Q]:a.push(Q),s++}}if(void 0!==e.user){var W=e.user;if(W&&"object"==typeof W&&!Array.isArray(W)){if(void 0===W.identities){var Y={instancePath:r+"/user",schemaPath:"#/definitions/User/required",keyword:"required",params:{missingProperty:"identities"},message:"must have required property 'identities'",schema:g.required,parentSchema:g,data:W};null===a?a=[Y]:a.push(Y),s++}if(void 0!==W.identities){var Z=W.identities;if(Z&&"object"==typeof Z&&!Array.isArray(Z))for(var ee in Z){var te=Z[ee];if("string"!=typeof te){var re={instancePath:r+"/user/identities/"+ee.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/definitions/User/properties/identities/additionalProperties/type",keyword:"type",params:{type:"string"},message:"must be string",schema:g.properties.identities.additionalProperties.type,parentSchema:g.properties.identities.additionalProperties,data:te};null===a?a=[re]:a.push(re),s++}}else{var ae={instancePath:r+"/user/identities",schemaPath:"#/definitions/User/properties/identities/type",keyword:"type",params:{type:"object"},message:"must be object",schema:g.properties.identities.type,parentSchema:g.properties.identities,data:Z};null===a?a=[ae]:a.push(ae),s++}}if(void 0!==W.segments){var se=W.segments;if(Array.isArray(se))for(var ie=se.length,oe=0;oe<ie;oe++){var ne=se[oe];if("string"!=typeof ne){var pe={instancePath:r+"/user/segments/"+oe,schemaPath:"#/definitions/User/properties/segments/items/type",keyword:"type",params:{type:"string"},message:"must be string",schema:g.properties.segments.items.type,parentSchema:g.properties.segments.items,data:ne};null===a?a=[pe]:a.push(pe),s++}}else{var ce={instancePath:r+"/user/segments",schemaPath:"#/definitions/User/properties/segments/type",keyword:"type",params:{type:"array"},message:"must be array",schema:g.properties.segments.type,parentSchema:g.properties.segments,data:se};null===a?a=[ce]:a.push(ce),s++}}if(void 0!==W.traits){var ue=W.traits;if(ue&&"object"==typeof ue&&!Array.isArray(ue));else{var de={instancePath:r+"/user/traits",schemaPath:"#/definitions/User/properties/traits/type",keyword:"type",params:{type:"object"},message:"must be object",schema:g.properties.traits.type,parentSchema:g.properties.traits,data:ue};null===a?a=[de]:a.push(de),s++}}}else{var he={instancePath:r+"/user",schemaPath:"#/definitions/User/type",keyword:"type",params:{type:"object"},message:"must be object",schema:g.type,parentSchema:g,data:W};null===a?a=[he]:a.push(he),s++}}}else{var ye={instancePath:r,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object",schema:f.type,parentSchema:f,data:e};null===a?a=[ye]:a.push(ye),s++}return v.errors=a,0===s}var b,P=m(l.exports),w=window&&window.__assign||function(){return w=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},w.apply(this,arguments)},S=window&&window.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(s,i){function o(e){try{p(a.next(e))}catch(e){i(e)}}function n(e){try{p(a.throw(e))}catch(e){i(e)}}function p(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,n)}p((a=a.apply(e,t||[])).next())}))},A=window&&window.__generator||function(e,t){var r,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function n(n){return function(p){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,n[0]&&(o=0)),o;)try{if(r=1,a&&(s=2&n[0]?a.return:n[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,a=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],a=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,p])}}},k=function(){function e(){this.isInitialized=!1,this.sample={action:"",target:{}},this.user={identities:{},segments:[],traits:{}}}return e.prototype.initUser=function(e){this.user.identities.sessionid||(this.user.identities.sessionid=e.getItem("attraqtsessionid")||y()),this.storage.setItem("attraqtsessionid",this.user.identities.sessionid)},e.prototype.assertIsInit=function(){if(!this.isInitialized)throw Error("The activities module must be initialized before using methods.")},e.prototype.init=function(e,t){var r;if(!e||!e.trackerKey)throw Error("A tracker key is required to initialize the activities module.");var a=(null===(r=e.region)||void 0===r?void 0:r.toLowerCase())||b.EU;this.apiUrl="http".concat(a!==b.DEV?"s":"","://collect-").concat(a,".attraqt.io/").concat(e.trackerKey),this.storage=e.storage,this.httpClient=t,this.initUser(this.storage),this.hasOptedOut="true"===this.storage.getItem("attraqtoptout"),this.isInitialized=!0},e.prototype.send=function(e,r){var a=this;if(!this.isInitialized)throw Error("The activities module must be initialized before sending activities.");var s=[].concat(e).map((function(e){var t=w(w({},e),{user:e&&e.user?e.user:a.user});if(!P(t))throw new Error("The provided activity does not match the required format.");return t}));if(this.hasOptedOut)return null;var i=w({method:t.Post,headers:{"Content-Type":"application/json"},url:this.apiUrl,body:JSON.stringify(s)},r);return this.httpClient.send(i)},e.prototype.sendAndStoreClusters=function(e,t){return S(this,void 0,void 0,(function(){var r,a,s;return A(this,(function(i){switch(i.label){case 0:return[4,this.send(e,t)];case 1:if((null==(r=i.sent())?void 0:r.status)<300){a=JSON.parse(r.body);try{s=a.profiles[Object.keys(a.profiles)[0]],this.storage.setItem("attraqtuserclusters",JSON.stringify(s.clusters))}catch(e){}return[2,a]}return[2,r]}}))}))},e.prototype.setUser=function(e){if(this.assertIsInit(),!e||!P(w(w({},this.sample),{user:e})))throw new TypeError("The provided user does not match the required format.");this.setUserIdentities(e.identities),this.setUserSegments(e.segments),this.setUserTraits(e.traits),this.initUser(this.storage)},e.prototype.addUserIdentity=function(e,t){if(this.assertIsInit(),"string"!=typeof e||"string"!=typeof t)throw new TypeError("identityRepository and identity must be strings.");this.user.identities[e.toLocaleLowerCase()]=t,this.initUser(this.storage)},e.prototype.setUserIdentities=function(e){if(this.assertIsInit(),!P(w(w({},this.sample),{user:{identities:e}}))||0===Object.keys(e).length)throw new TypeError("The provided identities do not match the required format.");this.user.identities=e,this.initUser(this.storage)},e.prototype.addUserSegment=function(e){if(this.assertIsInit(),"string"!=typeof e)throw new TypeError("segment must be a string.");this.user.segments.push(e)},e.prototype.setUserSegments=function(e){if(this.assertIsInit(),!Array.isArray(e)||e.some((function(e){return"string"!=typeof e})))throw new TypeError("segments must be an array of strings.");this.user.segments=e},e.prototype.addUserTrait=function(e,t){if(this.assertIsInit(),"string"!=typeof e||"string"!=typeof t)throw new TypeError("trait and traitValue must be strings.");this.user.traits[e]=t},e.prototype.setUserTraits=function(e){if(this.assertIsInit(),!P(w(w({},this.sample),{user:{identities:{},traits:e}})))throw new TypeError("The provided traits do not match the required format.");this.user.traits=e},e.prototype.clearUser=function(){this.assertIsInit(),this.user={identities:{},segments:[],traits:{}},this.storage.removeItem("attraqtsessionid"),this.initUser(this.storage)},e.prototype.optOut=function(){this.assertIsInit(),this.hasOptedOut=!0,this.storage.setItem("attraqtoptout","true")},e.prototype.optIn=function(){this.assertIsInit(),this.hasOptedOut=!1,this.storage.removeItem("attraqtoptout")},e}();!function(e){e.DEV="dev",e.EU="eu",e.AP1="ap1",e.AP2="ap2"}(b||(b={}));var O=window&&window.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.init=function(t,r){void 0===r&&(r=new n(window)),t.storage||(t.storage=window.localStorage),e.prototype.init.call(this,t,r)},t.prototype.send=function(t,r){return"1"===navigator.doNotTrack?null:e.prototype.send.call(this,t,r)},t.prototype.sendAndStoreClusters=function(t,r){return"1"===navigator.doNotTrack?null:e.prototype.sendAndStoreClusters.call(this,t,r)},t.prototype.handleQueuedEvents=function(){var e=this;[].concat(window._attraqt).filter((function(e){return Array.isArray(e)})).forEach((function(t){var r;(r=e)[t[0]].apply(r,t.filter((function(e){return e})).slice(1))})),window._attraqt=[]},t}(k),j=q,C=new q;C.handleQueuedEvents();var I={exports:{}};!function(e,t){!function(r,a){var s={version:"3.0.1",x86:{},x64:{}};function i(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function o(e,t){return e<<t|e>>>32-t}function n(e){return e=i(e^=e>>>16,2246822507),e=i(e^=e>>>13,3266489909),e^=e>>>16}function p(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function c(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function u(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function d(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function h(e,t){return[e[0]^t[0],e[1]^t[1]]}function y(e){return e=h(e,[0,e[0]>>>1]),e=h(e=c(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=h(e=c(e,[3301882366,444984403]),[0,e[0]>>>1])}s.x86.hash32=function(e,t){t=t||0;for(var r=(e=e||"").length%4,a=e.length-r,s=t,p=0,c=3432918353,u=461845907,d=0;d<a;d+=4)p=i(p=255&e.charCodeAt(d)|(255&e.charCodeAt(d+1))<<8|(255&e.charCodeAt(d+2))<<16|(255&e.charCodeAt(d+3))<<24,c),p=i(p=o(p,15),u),s=i(s=o(s^=p,13),5)+3864292196;switch(p=0,r){case 3:p^=(255&e.charCodeAt(d+2))<<16;case 2:p^=(255&e.charCodeAt(d+1))<<8;case 1:p=i(p^=255&e.charCodeAt(d),c),s^=p=i(p=o(p,15),u)}return(s=n(s^=e.length))>>>0},s.x86.hash128=function(e,t){t=t||0;for(var r=(e=e||"").length%16,a=e.length-r,s=t,p=t,c=t,u=t,d=0,h=0,y=0,m=0,l=597399067,f=2869860233,g=951274213,v=2716044179,b=0;b<a;b+=16)d=255&e.charCodeAt(b)|(255&e.charCodeAt(b+1))<<8|(255&e.charCodeAt(b+2))<<16|(255&e.charCodeAt(b+3))<<24,h=255&e.charCodeAt(b+4)|(255&e.charCodeAt(b+5))<<8|(255&e.charCodeAt(b+6))<<16|(255&e.charCodeAt(b+7))<<24,y=255&e.charCodeAt(b+8)|(255&e.charCodeAt(b+9))<<8|(255&e.charCodeAt(b+10))<<16|(255&e.charCodeAt(b+11))<<24,m=255&e.charCodeAt(b+12)|(255&e.charCodeAt(b+13))<<8|(255&e.charCodeAt(b+14))<<16|(255&e.charCodeAt(b+15))<<24,d=o(d=i(d,l),15),s=o(s^=d=i(d,f),19),s=i(s+=p,5)+1444728091,h=o(h=i(h,f),16),p=o(p^=h=i(h,g),17),p=i(p+=c,5)+197830471,y=o(y=i(y,g),17),c=o(c^=y=i(y,v),15),c=i(c+=u,5)+2530024501,m=o(m=i(m,v),18),u=o(u^=m=i(m,l),13),u=i(u+=s,5)+850148119;switch(d=0,h=0,y=0,m=0,r){case 15:m^=e.charCodeAt(b+14)<<16;case 14:m^=e.charCodeAt(b+13)<<8;case 13:m=i(m^=e.charCodeAt(b+12),v),u^=m=i(m=o(m,18),l);case 12:y^=e.charCodeAt(b+11)<<24;case 11:y^=e.charCodeAt(b+10)<<16;case 10:y^=e.charCodeAt(b+9)<<8;case 9:y=i(y^=e.charCodeAt(b+8),g),c^=y=i(y=o(y,17),v);case 8:h^=e.charCodeAt(b+7)<<24;case 7:h^=e.charCodeAt(b+6)<<16;case 6:h^=e.charCodeAt(b+5)<<8;case 5:h=i(h^=e.charCodeAt(b+4),f),p^=h=i(h=o(h,16),g);case 4:d^=e.charCodeAt(b+3)<<24;case 3:d^=e.charCodeAt(b+2)<<16;case 2:d^=e.charCodeAt(b+1)<<8;case 1:d=i(d^=e.charCodeAt(b),l),s^=d=i(d=o(d,15),f)}return s^=e.length,s+=p^=e.length,s+=c^=e.length,p+=s+=u^=e.length,c+=s,u+=s,s=n(s),s+=p=n(p),s+=c=n(c),p+=s+=u=n(u),c+=s,u+=s,("00000000"+(s>>>0).toString(16)).slice(-8)+("00000000"+(p>>>0).toString(16)).slice(-8)+("00000000"+(c>>>0).toString(16)).slice(-8)+("00000000"+(u>>>0).toString(16)).slice(-8)},s.x64.hash128=function(e,t){t=t||0;for(var r=(e=e||"").length%16,a=e.length-r,s=[0,t],i=[0,t],o=[0,0],n=[0,0],m=[2277735313,289559509],l=[1291169091,658871167],f=0;f<a;f+=16)o=[255&e.charCodeAt(f+4)|(255&e.charCodeAt(f+5))<<8|(255&e.charCodeAt(f+6))<<16|(255&e.charCodeAt(f+7))<<24,255&e.charCodeAt(f)|(255&e.charCodeAt(f+1))<<8|(255&e.charCodeAt(f+2))<<16|(255&e.charCodeAt(f+3))<<24],n=[255&e.charCodeAt(f+12)|(255&e.charCodeAt(f+13))<<8|(255&e.charCodeAt(f+14))<<16|(255&e.charCodeAt(f+15))<<24,255&e.charCodeAt(f+8)|(255&e.charCodeAt(f+9))<<8|(255&e.charCodeAt(f+10))<<16|(255&e.charCodeAt(f+11))<<24],o=u(o=c(o,m),31),s=p(s=u(s=h(s,o=c(o,l)),27),i),s=p(c(s,[0,5]),[0,1390208809]),n=u(n=c(n,l),33),i=p(i=u(i=h(i,n=c(n,m)),31),s),i=p(c(i,[0,5]),[0,944331445]);switch(o=[0,0],n=[0,0],r){case 15:n=h(n,d([0,e.charCodeAt(f+14)],48));case 14:n=h(n,d([0,e.charCodeAt(f+13)],40));case 13:n=h(n,d([0,e.charCodeAt(f+12)],32));case 12:n=h(n,d([0,e.charCodeAt(f+11)],24));case 11:n=h(n,d([0,e.charCodeAt(f+10)],16));case 10:n=h(n,d([0,e.charCodeAt(f+9)],8));case 9:n=c(n=h(n,[0,e.charCodeAt(f+8)]),l),i=h(i,n=c(n=u(n,33),m));case 8:o=h(o,d([0,e.charCodeAt(f+7)],56));case 7:o=h(o,d([0,e.charCodeAt(f+6)],48));case 6:o=h(o,d([0,e.charCodeAt(f+5)],40));case 5:o=h(o,d([0,e.charCodeAt(f+4)],32));case 4:o=h(o,d([0,e.charCodeAt(f+3)],24));case 3:o=h(o,d([0,e.charCodeAt(f+2)],16));case 2:o=h(o,d([0,e.charCodeAt(f+1)],8));case 1:o=c(o=h(o,[0,e.charCodeAt(f)]),m),s=h(s,o=c(o=u(o,31),l))}return s=p(s=h(s,[0,e.length]),i=h(i,[0,e.length])),i=p(i,s),s=p(s=y(s),i=y(i)),i=p(i,s),("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8)+("00000000"+(i[0]>>>0).toString(16)).slice(-8)+("00000000"+(i[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=s),t.murmurHash3=s}()}(I,I.exports);var x=I.exports,T=Object.freeze({__proto__:null,drawAbTestVariationForUser:function(e,t){var r=x.x86.hash32("".concat(e,"#").concat(t.id))%100+1,a=0;return{bucket:r,variationId:t.variations.find((function(e){return(a+=e.weight)>=r})).id}}}),_={exports:{}};_.exports=D,_.exports.default=D;var B={$schema:"http://json-schema.org/draft-07/schema#",additionalProperties:!1,definitions:{DisableOptions:{additionalProperties:!1,properties:{name:{description:'Feature to disable in the query\nExample: "facet", "item", "group", "redirect"',type:"string"}},required:["name"],type:"object"},FacetRequestOptions:{additionalProperties:!1,properties:{attribute:{description:"Selected facet to filter by\nTODO: Should be removed after migration to ids",type:"string"},id:{description:"Selected facet to filter by",type:"string"},values:{description:"Values of the facet used for filtering the results",items:{type:"string"},type:"array"}},required:["values"],type:"object"},SortOptions:{additionalProperties:!1,properties:{attribute:{description:"Attribute to sort by",type:"string"},order:{description:'Order of the sort.\nMust be either "asc" or "desc"',type:"string"}},required:["attribute","order"],type:"object"}},properties:{aiSearch:{description:'Toggle AI Search "on" or "off".\nIf true, AI Search is used\nIf false, regular fulltext search is used\nIf not specified, the type of search will be determined by the configuration',type:"boolean"},customResponseMask:{description:"Response mask to return only specific attributes of items",type:"string"},disable:{description:"DEPRECATED: top-level `disable` feature should be used instead",items:{$ref:"#/definitions/DisableOptions"},type:"array"},facets:{items:{$ref:"#/definitions/FacetRequestOptions"},type:"array"},filter:{description:"Filter string",type:"string"},limit:{description:"Pagination: size of the page",type:"number"},offset:{description:"Pagination: index of the first item to return",type:"number"},sortBy:{description:"List of sorting rules\n(applied in order)",items:{$ref:"#/definitions/SortOptions"},type:"array"}},type:"object"},U={additionalProperties:!1,properties:{name:{description:'Feature to disable in the query\nExample: "facet", "item", "group", "redirect"',type:"string"}},required:["name"],type:"object"},E={additionalProperties:!1,properties:{attribute:{description:"Selected facet to filter by\nTODO: Should be removed after migration to ids",type:"string"},id:{description:"Selected facet to filter by",type:"string"},values:{description:"Values of the facet used for filtering the results",items:{type:"string"},type:"array"}},required:["values"],type:"object"},R={additionalProperties:!1,properties:{attribute:{description:"Attribute to sort by",type:"string"},order:{description:'Order of the sort.\nMust be either "asc" or "desc"',type:"string"}},required:["attribute","order"],type:"object"};function D(e,t){if(t){var r=t.instancePath;t.parentData,t.parentDataProperty,t.rootData}else r="";var a=null,s=0;if(e&&"object"==typeof e&&!Array.isArray(e)){for(var i in e)if("aiSearch"!==i&&"customResponseMask"!==i&&"disable"!==i&&"facets"!==i&&"filter"!==i&&"limit"!==i&&"offset"!==i&&"sortBy"!==i){var o={instancePath:r,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:i},message:"must NOT have additional properties",schema:!1,parentSchema:B,data:e};null===a?a=[o]:a.push(o),s++}if(void 0!==e.aiSearch){var n=e.aiSearch;if("boolean"!=typeof n){var p={instancePath:r+"/aiSearch",schemaPath:"#/properties/aiSearch/type",keyword:"type",params:{type:"boolean"},message:"must be boolean",schema:B.properties.aiSearch.type,parentSchema:B.properties.aiSearch,data:n};null===a?a=[p]:a.push(p),s++}}if(void 0!==e.customResponseMask){var c=e.customResponseMask;if("string"!=typeof c){var u={instancePath:r+"/customResponseMask",schemaPath:"#/properties/customResponseMask/type",keyword:"type",params:{type:"string"},message:"must be string",schema:B.properties.customResponseMask.type,parentSchema:B.properties.customResponseMask,data:c};null===a?a=[u]:a.push(u),s++}}if(void 0!==e.disable){var d=e.disable;if(Array.isArray(d))for(var h=d.length,y=0;y<h;y++){var m=d[y];if(m&&"object"==typeof m&&!Array.isArray(m)){if(void 0===m.name){var l={instancePath:r+"/disable/"+y,schemaPath:"#/definitions/DisableOptions/required",keyword:"required",params:{missingProperty:"name"},message:"must have required property 'name'",schema:U.required,parentSchema:U,data:m};null===a?a=[l]:a.push(l),s++}for(var f in m)if("name"!==f){var g={instancePath:r+"/disable/"+y,schemaPath:"#/definitions/DisableOptions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:f},message:"must NOT have additional properties",schema:!1,parentSchema:U,data:m};null===a?a=[g]:a.push(g),s++}if(void 0!==m.name){var v=m.name;if("string"!=typeof v){var b={instancePath:r+"/disable/"+y+"/name",schemaPath:"#/definitions/DisableOptions/properties/name/type",keyword:"type",params:{type:"string"},message:"must be string",schema:U.properties.name.type,parentSchema:U.properties.name,data:v};null===a?a=[b]:a.push(b),s++}}}else{var P={instancePath:r+"/disable/"+y,schemaPath:"#/definitions/DisableOptions/type",keyword:"type",params:{type:"object"},message:"must be object",schema:U.type,parentSchema:U,data:m};null===a?a=[P]:a.push(P),s++}}else{var w={instancePath:r+"/disable",schemaPath:"#/properties/disable/type",keyword:"type",params:{type:"array"},message:"must be array",schema:B.properties.disable.type,parentSchema:B.properties.disable,data:d};null===a?a=[w]:a.push(w),s++}}if(void 0!==e.facets){var S=e.facets;if(Array.isArray(S))for(var A=S.length,k=0;k<A;k++){var O=S[k];if(O&&"object"==typeof O&&!Array.isArray(O)){if(void 0===O.values){var q={instancePath:r+"/facets/"+k,schemaPath:"#/definitions/FacetRequestOptions/required",keyword:"required",params:{missingProperty:"values"},message:"must have required property 'values'",schema:E.required,parentSchema:E,data:O};null===a?a=[q]:a.push(q),s++}for(var j in O)if("attribute"!==j&&"id"!==j&&"values"!==j){var C={instancePath:r+"/facets/"+k,schemaPath:"#/definitions/FacetRequestOptions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:j},message:"must NOT have additional properties",schema:!1,parentSchema:E,data:O};null===a?a=[C]:a.push(C),s++}if(void 0!==O.attribute){var I=O.attribute;if("string"!=typeof I){var x={instancePath:r+"/facets/"+k+"/attribute",schemaPath:"#/definitions/FacetRequestOptions/properties/attribute/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.attribute.type,parentSchema:E.properties.attribute,data:I};null===a?a=[x]:a.push(x),s++}}if(void 0!==O.id){var T=O.id;if("string"!=typeof T){var _={instancePath:r+"/facets/"+k+"/id",schemaPath:"#/definitions/FacetRequestOptions/properties/id/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.id.type,parentSchema:E.properties.id,data:T};null===a?a=[_]:a.push(_),s++}}if(void 0!==O.values){var z=O.values;if(Array.isArray(z))for(var F=z.length,M=0;M<F;M++){var N=z[M];if("string"!=typeof N){var G={instancePath:r+"/facets/"+k+"/values/"+M,schemaPath:"#/definitions/FacetRequestOptions/properties/values/items/type",keyword:"type",params:{type:"string"},message:"must be string",schema:E.properties.values.items.type,parentSchema:E.properties.values.items,data:N};null===a?a=[G]:a.push(G),s++}}else{var $={instancePath:r+"/facets/"+k+"/values",schemaPath:"#/definitions/FacetRequestOptions/properties/values/type",keyword:"type",params:{type:"array"},message:"must be array",schema:E.properties.values.type,parentSchema:E.properties.values,data:z};null===a?a=[$]:a.push($),s++}}}else{var L={instancePath:r+"/facets/"+k,schemaPath:"#/definitions/FacetRequestOptions/type",keyword:"type",params:{type:"object"},message:"must be object",schema:E.type,parentSchema:E,data:O};null===a?a=[L]:a.push(L),s++}}else{var V={instancePath:r+"/facets",schemaPath:"#/properties/facets/type",keyword:"type",params:{type:"array"},message:"must be array",schema:B.properties.facets.type,parentSchema:B.properties.facets,data:S};null===a?a=[V]:a.push(V),s++}}if(void 0!==e.filter){var J=e.filter;if("string"!=typeof J){var H={instancePath:r+"/filter",schemaPath:"#/properties/filter/type",keyword:"type",params:{type:"string"},message:"must be string",schema:B.properties.filter.type,parentSchema:B.properties.filter,data:J};null===a?a=[H]:a.push(H),s++}}if(void 0!==e.limit){var K=e.limit;if("number"!=typeof K||!isFinite(K)){var X={instancePath:r+"/limit",schemaPath:"#/properties/limit/type",keyword:"type",params:{type:"number"},message:"must be number",schema:B.properties.limit.type,parentSchema:B.properties.limit,data:K};null===a?a=[X]:a.push(X),s++}}if(void 0!==e.offset){var Q=e.offset;if("number"!=typeof Q||!isFinite(Q)){var W={instancePath:r+"/offset",schemaPath:"#/properties/offset/type",keyword:"type",params:{type:"number"},message:"must be number",schema:B.properties.offset.type,parentSchema:B.properties.offset,data:Q};null===a?a=[W]:a.push(W),s++}}if(void 0!==e.sortBy){var Y=e.sortBy;if(Array.isArray(Y))for(var Z=Y.length,ee=0;ee<Z;ee++){var te=Y[ee];if(te&&"object"==typeof te&&!Array.isArray(te)){if(void 0===te.attribute){var re={instancePath:r+"/sortBy/"+ee,schemaPath:"#/definitions/SortOptions/required",keyword:"required",params:{missingProperty:"attribute"},message:"must have required property 'attribute'",schema:R.required,parentSchema:R,data:te};null===a?a=[re]:a.push(re),s++}if(void 0===te.order){var ae={instancePath:r+"/sortBy/"+ee,schemaPath:"#/definitions/SortOptions/required",keyword:"required",params:{missingProperty:"order"},message:"must have required property 'order'",schema:R.required,parentSchema:R,data:te};null===a?a=[ae]:a.push(ae),s++}for(var se in te)if("attribute"!==se&&"order"!==se){var ie={instancePath:r+"/sortBy/"+ee,schemaPath:"#/definitions/SortOptions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:se},message:"must NOT have additional properties",schema:!1,parentSchema:R,data:te};null===a?a=[ie]:a.push(ie),s++}if(void 0!==te.attribute){var oe=te.attribute;if("string"!=typeof oe){var ne={instancePath:r+"/sortBy/"+ee+"/attribute",schemaPath:"#/definitions/SortOptions/properties/attribute/type",keyword:"type",params:{type:"string"},message:"must be string",schema:R.properties.attribute.type,parentSchema:R.properties.attribute,data:oe};null===a?a=[ne]:a.push(ne),s++}}if(void 0!==te.order){var pe=te.order;if("string"!=typeof pe){var ce={instancePath:r+"/sortBy/"+ee+"/order",schemaPath:"#/definitions/SortOptions/properties/order/type",keyword:"type",params:{type:"string"},message:"must be string",schema:R.properties.order.type,parentSchema:R.properties.order,data:pe};null===a?a=[ce]:a.push(ce),s++}}}else{var ue={instancePath:r+"/sortBy/"+ee,schemaPath:"#/definitions/SortOptions/type",keyword:"type",params:{type:"object"},message:"must be object",schema:R.type,parentSchema:R,data:te};null===a?a=[ue]:a.push(ue),s++}}else{var de={instancePath:r+"/sortBy",schemaPath:"#/properties/sortBy/type",keyword:"type",params:{type:"array"},message:"must be array",schema:B.properties.sortBy.type,parentSchema:B.properties.sortBy,data:Y};null===a?a=[de]:a.push(de),s++}}}else{var he={instancePath:r,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object",schema:B.type,parentSchema:B,data:e};null===a?a=[he]:a.push(he),s++}return D.errors=a,0===s}var z=m(_.exports),F={exports:{}};F.exports=$,F.exports.default=$;var M={$schema:"http://json-schema.org/draft-07/schema#",additionalProperties:!1,definitions:{GroupByOptions:{additionalProperties:!1,properties:{attribute:{type:"string"},size:{type:"number"},values:{items:{type:"string"},type:"array"}},required:["attribute","size","values"],type:"object"},SortOptions:{additionalProperties:!1,properties:{attribute:{description:"Attribute to sort by",type:"string"},order:{description:'Order of the sort.\nMust be either "asc" or "desc"',type:"string"}},required:["attribute","order"],type:"object"}},properties:{customResponseMask:{description:"Response mask to return only specific attributes of items",type:"string"},filter:{description:"Filter string",type:"string"},groupBy:{$ref:"#/definitions/GroupByOptions",description:"Select which attribute & values for grouping the results.\nIf specified, this will add a `groups` list in the response, alongside the regular `items` list"},sortBy:{description:"List of sorting rules\n(applied in order)",items:{$ref:"#/definitions/SortOptions"},type:"array"}},type:"object"},N={additionalProperties:!1,properties:{attribute:{type:"string"},size:{type:"number"},values:{items:{type:"string"},type:"array"}},required:["attribute","size","values"],type:"object"},G={additionalProperties:!1,properties:{attribute:{description:"Attribute to sort by",type:"string"},order:{description:'Order of the sort.\nMust be either "asc" or "desc"',type:"string"}},required:["attribute","order"],type:"object"};function $(e,t){if(t){var r=t.instancePath;t.parentData,t.parentDataProperty,t.rootData}else r="";var a=null,s=0;if(e&&"object"==typeof e&&!Array.isArray(e)){for(var i in e)if("customResponseMask"!==i&&"filter"!==i&&"groupBy"!==i&&"sortBy"!==i){var o={instancePath:r,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:i},message:"must NOT have additional properties",schema:!1,parentSchema:M,data:e};null===a?a=[o]:a.push(o),s++}if(void 0!==e.customResponseMask){var n=e.customResponseMask;if("string"!=typeof n){var p={instancePath:r+"/customResponseMask",schemaPath:"#/properties/customResponseMask/type",keyword:"type",params:{type:"string"},message:"must be string",schema:M.properties.customResponseMask.type,parentSchema:M.properties.customResponseMask,data:n};null===a?a=[p]:a.push(p),s++}}if(void 0!==e.filter){var c=e.filter;if("string"!=typeof c){var u={instancePath:r+"/filter",schemaPath:"#/properties/filter/type",keyword:"type",params:{type:"string"},message:"must be string",schema:M.properties.filter.type,parentSchema:M.properties.filter,data:c};null===a?a=[u]:a.push(u),s++}}if(void 0!==e.groupBy){var d=e.groupBy;if(d&&"object"==typeof d&&!Array.isArray(d)){if(void 0===d.attribute){var h={instancePath:r+"/groupBy",schemaPath:"#/definitions/GroupByOptions/required",keyword:"required",params:{missingProperty:"attribute"},message:"must have required property 'attribute'",schema:N.required,parentSchema:N,data:d};null===a?a=[h]:a.push(h),s++}if(void 0===d.size){var y={instancePath:r+"/groupBy",schemaPath:"#/definitions/GroupByOptions/required",keyword:"required",params:{missingProperty:"size"},message:"must have required property 'size'",schema:N.required,parentSchema:N,data:d};null===a?a=[y]:a.push(y),s++}if(void 0===d.values){var m={instancePath:r+"/groupBy",schemaPath:"#/definitions/GroupByOptions/required",keyword:"required",params:{missingProperty:"values"},message:"must have required property 'values'",schema:N.required,parentSchema:N,data:d};null===a?a=[m]:a.push(m),s++}for(var l in d)if("attribute"!==l&&"size"!==l&&"values"!==l){var f={instancePath:r+"/groupBy",schemaPath:"#/definitions/GroupByOptions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:l},message:"must NOT have additional properties",schema:!1,parentSchema:N,data:d};null===a?a=[f]:a.push(f),s++}if(void 0!==d.attribute){var g=d.attribute;if("string"!=typeof g){var v={instancePath:r+"/groupBy/attribute",schemaPath:"#/definitions/GroupByOptions/properties/attribute/type",keyword:"type",params:{type:"string"},message:"must be string",schema:N.properties.attribute.type,parentSchema:N.properties.attribute,data:g};null===a?a=[v]:a.push(v),s++}}if(void 0!==d.size){var b=d.size;if("number"!=typeof b||!isFinite(b)){var P={instancePath:r+"/groupBy/size",schemaPath:"#/definitions/GroupByOptions/properties/size/type",keyword:"type",params:{type:"number"},message:"must be number",schema:N.properties.size.type,parentSchema:N.properties.size,data:b};null===a?a=[P]:a.push(P),s++}}if(void 0!==d.values){var w=d.values;if(Array.isArray(w))for(var S=w.length,A=0;A<S;A++){var k=w[A];if("string"!=typeof k){var O={instancePath:r+"/groupBy/values/"+A,schemaPath:"#/definitions/GroupByOptions/properties/values/items/type",keyword:"type",params:{type:"string"},message:"must be string",schema:N.properties.values.items.type,parentSchema:N.properties.values.items,data:k};null===a?a=[O]:a.push(O),s++}}else{var q={instancePath:r+"/groupBy/values",schemaPath:"#/definitions/GroupByOptions/properties/values/type",keyword:"type",params:{type:"array"},message:"must be array",schema:N.properties.values.type,parentSchema:N.properties.values,data:w};null===a?a=[q]:a.push(q),s++}}}else{var j={instancePath:r+"/groupBy",schemaPath:"#/definitions/GroupByOptions/type",keyword:"type",params:{type:"object"},message:"must be object",schema:N.type,parentSchema:N,data:d};null===a?a=[j]:a.push(j),s++}}if(void 0!==e.sortBy){var C=e.sortBy;if(Array.isArray(C))for(var I=C.length,x=0;x<I;x++){var T=C[x];if(T&&"object"==typeof T&&!Array.isArray(T)){if(void 0===T.attribute){var _={instancePath:r+"/sortBy/"+x,schemaPath:"#/definitions/SortOptions/required",keyword:"required",params:{missingProperty:"attribute"},message:"must have required property 'attribute'",schema:G.required,parentSchema:G,data:T};null===a?a=[_]:a.push(_),s++}if(void 0===T.order){var B={instancePath:r+"/sortBy/"+x,schemaPath:"#/definitions/SortOptions/required",keyword:"required",params:{missingProperty:"order"},message:"must have required property 'order'",schema:G.required,parentSchema:G,data:T};null===a?a=[B]:a.push(B),s++}for(var U in T)if("attribute"!==U&&"order"!==U){var E={instancePath:r+"/sortBy/"+x,schemaPath:"#/definitions/SortOptions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:U},message:"must NOT have additional properties",schema:!1,parentSchema:G,data:T};null===a?a=[E]:a.push(E),s++}if(void 0!==T.attribute){var R=T.attribute;if("string"!=typeof R){var D={instancePath:r+"/sortBy/"+x+"/attribute",schemaPath:"#/definitions/SortOptions/properties/attribute/type",keyword:"type",params:{type:"string"},message:"must be string",schema:G.properties.attribute.type,parentSchema:G.properties.attribute,data:R};null===a?a=[D]:a.push(D),s++}}if(void 0!==T.order){var z=T.order;if("string"!=typeof z){var F={instancePath:r+"/sortBy/"+x+"/order",schemaPath:"#/definitions/SortOptions/properties/order/type",keyword:"type",params:{type:"string"},message:"must be string",schema:G.properties.order.type,parentSchema:G.properties.order,data:z};null===a?a=[F]:a.push(F),s++}}}else{var L={instancePath:r+"/sortBy/"+x,schemaPath:"#/definitions/SortOptions/type",keyword:"type",params:{type:"object"},message:"must be object",schema:G.type,parentSchema:G,data:T};null===a?a=[L]:a.push(L),s++}}else{var V={instancePath:r+"/sortBy",schemaPath:"#/properties/sortBy/type",keyword:"type",params:{type:"array"},message:"must be array",schema:M.properties.sortBy.type,parentSchema:M.properties.sortBy,data:C};null===a?a=[V]:a.push(V),s++}}}else{var J={instancePath:r,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object",schema:M.type,parentSchema:M,data:e};null===a?a=[J]:a.push(J),s++}return $.errors=a,0===s}var L=m(F.exports),V={exports:{}};V.exports=H,V.exports.default=H;var J={$schema:"http://json-schema.org/draft-07/schema#",additionalProperties:!1,properties:{session:{additionalProperties:{type:"string"},description:"Identify the user using a set of `$identityRepository/$userId` key/value pairs.\nUsually, one of the `$identityRepository` is `sessionId`.",type:"object"},variables:{additionalProperties:{},description:"List of XO context variables attached to the request. The variables will be resolved according\nto your configuration in the XO Console.",type:"object"}},type:"object"};function H(e,t){if(t){var r=t.instancePath;t.parentData,t.parentDataProperty,t.rootData}else r="";var a=null,s=0;if(e&&"object"==typeof e&&!Array.isArray(e)){for(var i in e)if("session"!==i&&"variables"!==i){var o={instancePath:r,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:i},message:"must NOT have additional properties",schema:!1,parentSchema:J,data:e};null===a?a=[o]:a.push(o),s++}if(void 0!==e.session){var n=e.session;if(n&&"object"==typeof n&&!Array.isArray(n))for(var p in n){var c=n[p];if("string"!=typeof c){var u={instancePath:r+"/session/"+p.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/session/additionalProperties/type",keyword:"type",params:{type:"string"},message:"must be string",schema:J.properties.session.additionalProperties.type,parentSchema:J.properties.session.additionalProperties,data:c};null===a?a=[u]:a.push(u),s++}}else{var d={instancePath:r+"/session",schemaPath:"#/properties/session/type",keyword:"type",params:{type:"object"},message:"must be object",schema:J.properties.session.type,parentSchema:J.properties.session,data:n};null===a?a=[d]:a.push(d),s++}}if(void 0!==e.variables){var h=e.variables;if(h&&"object"==typeof h&&!Array.isArray(h));else{var y={instancePath:r+"/variables",schemaPath:"#/properties/variables/type",keyword:"type",params:{type:"object"},message:"must be object",schema:J.properties.variables.type,parentSchema:J.properties.variables,data:h};null===a?a=[y]:a.push(y),s++}}}else{var m={instancePath:r,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object",schema:J.type,parentSchema:J,data:e};null===a?a=[m]:a.push(m),s++}return H.errors=a,0===s}var K=m(V.exports),X={exports:{}};X.exports=W,X.exports.default=W;var Q={$schema:"http://json-schema.org/draft-07/schema#",additionalProperties:!1,properties:{filter:{description:"Filter string",type:"string"},numberOfSuggestions:{description:"Number of suggestions to be returned",type:"number"}},type:"object"};function W(e,t){if(t){var r=t.instancePath;t.parentData,t.parentDataProperty,t.rootData}else r="";var a=null,s=0;if(e&&"object"==typeof e&&!Array.isArray(e)){for(var i in e)if("filter"!==i&&"numberOfSuggestions"!==i){var o={instancePath:r,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:i},message:"must NOT have additional properties",schema:!1,parentSchema:Q,data:e};null===a?a=[o]:a.push(o),s++}if(void 0!==e.filter){var n=e.filter;if("string"!=typeof n){var p={instancePath:r+"/filter",schemaPath:"#/properties/filter/type",keyword:"type",params:{type:"string"},message:"must be string",schema:Q.properties.filter.type,parentSchema:Q.properties.filter,data:n};null===a?a=[p]:a.push(p),s++}}if(void 0!==e.numberOfSuggestions){var c=e.numberOfSuggestions;if("number"!=typeof c||!isFinite(c)){var u={instancePath:r+"/numberOfSuggestions",schemaPath:"#/properties/numberOfSuggestions/type",keyword:"type",params:{type:"number"},message:"must be number",schema:Q.properties.numberOfSuggestions.type,parentSchema:Q.properties.numberOfSuggestions,data:c};null===a?a=[u]:a.push(u),s++}}}else{var d={instancePath:r,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object",schema:Q.type,parentSchema:Q,data:e};null===a?a=[d]:a.push(d),s++}return W.errors=a,0===s}var Y,Z=m(X.exports),ee=window&&window.__assign||function(){return ee=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},ee.apply(this,arguments)},te=window&&window.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(s,i){function o(e){try{p(a.next(e))}catch(e){i(e)}}function n(e){try{p(a.throw(e))}catch(e){i(e)}}function p(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,n)}p((a=a.apply(e,t||[])).next())}))},re=window&&window.__generator||function(e,t){var r,a,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function n(n){return function(p){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,n[0]&&(o=0)),o;)try{if(r=1,a&&(s=2&n[0]?a.return:n[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,a=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],a=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,p])}}},ae=function(){function e(){this.isInitialized=!1}return e.prototype.init=function(e,t){if(!e||!e.token)throw Error("A token is required to initialize the search module.");this.token=e.token,this.httpClient=t,this.region=this.configureRegion(e),this.isInitialized=!0},e.prototype.query=function(e,t,r,a){return te(this,void 0,void 0,(function(){return re(this,(function(s){if(this.assertIsInit(),t&&!z(t))throw Error("The provided search options doesn't match the required format.");if(a&&!K(a))throw Error("The provided search context doesn't match the required format.");return[2,this.sendRequest("/search",e,t,a,r)]}))}))},e.prototype.suggest=function(e,t,r,a){return te(this,void 0,void 0,(function(){return re(this,(function(s){if(this.assertIsInit(),t&&!L(t))throw Error("The provided group options don't match the required format.");if(a&&!K(a))throw Error("The provided search context doesn't match the required format.");return[2,this.sendRequest("/search/suggest",e,t,a,r)]}))}))},e.prototype.autocomplete=function(e,t,r){return te(this,void 0,void 0,(function(){return re(this,(function(a){if(this.assertIsInit(),t&&!Z(t))throw Error("The provided autocomplete options don't match the required format.");return[2,this.sendRequest("/search/autocomplete",e,t,void 0,r)]}))}))},e.prototype.sendRequest=function(e,r,a,s,i){return te(this,void 0,void 0,(function(){var o,n;return re(this,(function(p){switch(p.label){case 0:return o=ee({method:t.Post,headers:{"Content-Type":"application/json"},url:"https://api-".concat(this.region,".attraqt.io").concat(e),body:JSON.stringify({query:r,token:this.token,options:a,context:s})},i),[4,this.httpClient.send(o)];case 1:if((n=p.sent()).status<300)return[2,JSON.parse(n.body)];throw new Error("HTTP Error ".concat(n.status,": ").concat(n.body))}}))}))},e.prototype.assertIsInit=function(){if(!this.isInitialized)throw Error("The search module must be initialized before using methods.")},e.prototype.configureRegion=function(e){var t=e.region;return Object.values(Y).includes(null==t?void 0:t.toLowerCase())?t.toLowerCase():Y.EU},e}();!function(e){e.EU="eu",e.AU="au",e.US="us"}(Y||(Y={}));var se=window&&window.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return se(t,e),t.prototype.init=function(t,r){void 0===r&&(r=new n(window)),e.prototype.init.call(this,t,r)},t}(ae),oe=ie,ne=new ie;return e.Activity=j,e.Search=oe,e.abTest=T,e.activity=C,e.init=function(e){void 0===e&&(e={}),e.activity&&C.init(e.activity),e.search&&ne.init(e.search)},e.search=ne,e}({});
